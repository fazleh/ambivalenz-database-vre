<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>{{ title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/screen.css') }}">

  <script src="{{ url_for('static', filename='js/jquery-3.1.1.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/jquery.detect_swipe.js') }}"></script>
  <script src="{{ url_for('static', filename='js/helper.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      padding: 20px;
    }

    .container {
      display: flex;
      align-items: flex-start;
      gap: 20px;
      max-width: 1300px;
      margin: 40px auto;
    }

    .portrait {
      width: 400px;
      height: 400px;
      object-fit: contain;
      background-color: #eeeeee;
      border-radius: 8px;
      border: 2px solid black;
      flex-shrink: 0;
    }

    .text {
      flex-grow: 1;
      border: 2px solid black;
      padding: 20px;
      border-radius: 8px;
      font-size: 18px;
      box-sizing: border-box;
    }

    .property-table textarea {
      width: 100%;
      min-height: 38px;
      resize: vertical;
      border: 1px solid #aaa;
      border-radius: 3px;
      padding: 4px 6px;
      font-size: 13px;
      line-height: 1.3;
    }

    h2 {
      text-align: center;
      margin-top: 40px;
      margin-bottom: 20px;
      color: #333333;
    }

    table.property-table {
      width: 95%;
      margin: 16px auto;
      border-collapse: collapse;
      background-color: #ffffff;
      font-size: 14px;
    }

    table.property-table th,
    table.property-table td {
      border: 1px solid #bbb;
      padding: 6px 8px;
      vertical-align: top;
      line-height: 1.3;
    }

    table.property-table th {
      background-color: #f0f0f0;
      font-weight: 600;
      text-align: left;
    }

    table.property-table tr:nth-child(even) {
      background-color: #fafafa;
    }

    .traffic-light {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
      cursor: pointer;
      border: 1px solid #333;
    }

    .red    { background: #c0392b; }
    .yellow { background: #f1c40f; }
    .green  { background: #27ae60; }
    .gray   { background: #ccc; }

    footer.site {
      margin-top: 40px;
      text-align: center;
    }
  </style>
</head>

<body class="bundle list">

<header class="site">
  <a id="header-logo" href="{{ url_for('visual_art') }}">
    <img class="logo"
         src="{{ url_for('static', filename='images/Uni_Marburg_Siegel.png') }}"
         alt="Uni Marburg Logo">
  </a>
  <h1 id="header-title">{{ title }}</h1>
</header>

<div class="container">
  <img class="portrait"
       src="{{ url_for('static', filename=image_path if image_path and image_path != 'No data' else 'images/placeholder.png') }}"
       alt="{{ title }}">

  <div class="text">
    <p>{{ artist_info }}</p>
  </div>
</div>

<h2>Object Information</h2>

<!-- ðŸ”½ FORM START -->
<form method="POST" action="{{ url_for('send_edit_link', object_id=title) }}">

<table class="property-table">
  <thead>
    <tr>
      <th>Property</th>
      <th>Value</th>
      <th>Status</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>

  {% for row in table_rows %}
  <tr>
    <td>{{ row.property }}</td>

    <td>
      {% if row.value is string and row.value.startswith("http") %}
        <a href="{{ row.value }}" target="_blank">{{ row.value }}</a>
      {% else %}
        {{ row.value }}
      {% endif %}
    </td>

    <td style="text-align:center;">
      {% set color = row.status if row.status else 'gray' %}
      <div class="traffic-light {{ color }}"
           id="light_{{ loop.index }}"
           onclick="cycleLight('{{ loop.index }}')"></div>

      <input type="hidden"
             name="status_{{ row.property }}"
             id="traffic_{{ loop.index }}"
             value="{{ color }}">
    </td>

    <td>
      <textarea
        name="comment_{{ row.property }}"
        rows="3"
        placeholder="Write a comment here...">{{ row.comment or "" }}</textarea>
    </td>
  </tr>
  {% endfor %}

  </tbody>
</table>

<!-- âœ… SUBMIT BUTTON -->
<div style="text-align:center; margin:30px;">
  <button type="submit"
          style="padding:12px 24px; font-size:16px;">
    Send editable link by email
  </button>
</div>

</form>
<!-- ðŸ”¼ FORM END -->

<footer class="site">
  <div class="footer-title">Antiziganismus und Ambivalenz in Europa</div>
</footer>

<script>
function cycleLight(id) {
  const light = document.getElementById("light_" + id);
  const hidden = document.getElementById("traffic_" + id);

  if (hidden.value === "green") return; // ðŸ”’ lock green

  const order = ["gray", "yellow", "red"];
  const current = hidden.value || "gray";
  const next = order[(order.indexOf(current) + 1) % order.length];

  hidden.value = next;
  light.className = "traffic-light " + next;
}
</script>

</body>
</html>
